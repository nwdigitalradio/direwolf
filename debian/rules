#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all


DEB_BUILD_ARCH ?= $(shell dpkg-architecture -qDEB_BUILD_ARCH)
ifeq "$(DEB_BUILD_ARCH)" "armhf"
	CFLAGS += -O3 -ffast-math -mfpu=neon-vfpv4 -funsafe-math-optimizations
else ifeq "$(DEB_BUILD_ARCH)" "amd64"
	CFLAGS += -O3 -ffast-math -march=native
endif

%:
	dh $@ --with=systemd

override_dh_auto_build:
	make -f Makefile.linux

override_dh_installinit:
	dh_installinit --no-start --noscripts
override_dh_auto_install:
	@echo "Skipping the install to /usr/local"

override_dh_auto_clean:
	make -f Makefile.linux clean
	-rm gen_fff
	-rm direwolf.conf

override_dh_fixperms-arch:
	dh_fixperms
	chmod 644 debian/direwolf/usr/share/direwolf/dw-icon.png
override_dh_systemd_enable:
	dh_systemd_enable \
		--no-enable
